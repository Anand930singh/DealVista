# Reward Points System - Quick Reference Card\n\n## ğŸ“‹ Summary\n\n| Feature | Details |\n|---------|----------|\n| **Earn Points** | +5 when coupon listed successfully |\n| **Spend Points** | -5 when viewing coupon code |\n| **Validation** | Won't spend if insufficient points |\n| **Toast Feedback** | Green (success), Blue (info), Red (error) |\n| **Authentication** | Required for all operations |\n| **User Isolation** | Points per user, not shared |\n\n---\n\n## ğŸ”— Key Endpoints\n\n### List Coupon (Earn 5 Points)\n```\nPOST /coupons\nHeader: Authorization: Bearer {token}\nBody: CouponRequestDto\nResponse: 201 CREATED â†’ +5 points\n```\n\n### View Coupon Code (Spend 5 Points) â­ NEW\n```\nPOST /coupons/{id}/view-code\nHeader: Authorization: Bearer {token}\nResponse: \n  - 200 OK â†’ -5 points (success)\n  - 400 BAD_REQUEST â†’ error message (failure)\n```\n\n---\n\n## ğŸ¨ Toast Notifications\n\n| Scenario | Type | Message | Color |\n|----------|------|---------|-------|\n| Coupon listed âœ“ | success | \"Coupon listed successfully!\" | ğŸŸ¢ Green |\n| Code revealed âœ“ | info | \"5 points deducted! Code revealed.\" | ğŸ”µ Blue |\n| Insufficient points âœ— | error | \"Insufficient reward points\" | ğŸ”´ Red |\n| List failed âœ— | error | Error message | ğŸ”´ Red |\n\n---\n\n## ğŸ§  Business Logic\n\n### Adding Points (Backend)\n```\nCouponListingService.save()\n  â†“\nif (coupon created successfully)\n  call RewardPointsService.addPointsByEmail(email, 5)\n  â†“\n  user.points += 5\n  user.save()\nelse\n  throw exception\n```\n\n### Deducting Points (Backend)\n```\nif (user.points < 5)\n  throw \"Insufficient reward points\"\nelse\n  user.points -= 5\n  user.save()\n  return success\n```\n\n### Frontend Logic (Modal)\n```\nif (user clicks eye button)\n  if (code already visible)\n    hide code\n  else\n    if (user has sufficient points)\n      show code + blue toast\n    else\n      show error toast\n```\n\n---\n\n## ğŸ“ Files to Review\n\n**Backend:**\n- `RewardPointsService.java` - Business logic\n- `CouponController.java` - REST endpoint\n- `CouponListingService.java` - Add points (already done)\n\n**Frontend:**\n- `api.js` - API call\n- `CouponDetailModal.jsx` - UI & logic\n- `BrowseCoupons.jsx` - Integration\n- `CouponForm.jsx` - Toast notifications (already done)\n\n---\n\n## ğŸš€ Usage Examples\n\n### JavaScript API Call\n```javascript\n// Reveal coupon code and spend 5 points\ntry {\n  const response = await couponAPI.viewCouponCode(couponId)\n  // Success - points deducted\n  showToast(\"5 points deducted! Code revealed.\", \"info\")\n} catch (error) {\n  // Failed - check error message\n  showToast(error.message, \"error\")\n}\n```\n\n### Java Backend Logic\n```java\n// In CouponController\npublic ResponseEntity<?> viewCouponCode(\n    @PathVariable UUID id, \n    Authentication authentication) {\n  try {\n    // Deduct 5 points from authenticated user\n    rewardPointsService.deductPointsByEmail(\n        authentication.getName(), 5);\n    return ResponseEntity.ok(\n        Map.of(\"message\", \"5 points deducted successfully\"));\n  } catch (RuntimeException e) {\n    return ResponseEntity.badRequest()\n        .body(Map.of(\"message\", e.getMessage()));\n  }\n}\n```\n\n---\n\n## âœ¨ Key Points\n\n- âœ… Points earned when coupon listed (backend automated)\n- âœ… Points spent when code viewed (frontend calls backend)\n- âœ… Validation prevents overspending\n- âœ… Clear user feedback via toasts\n- âœ… Error handling for edge cases\n- âœ… User data integrity maintained\n- âœ… No compilation errors\n- âœ… Production-ready\n\n---\n\n## ğŸ› Debug Checklist\n\nIf something isn't working:\n\n- [ ] Check backend is running (`http://localhost:8080`)\n- [ ] Check frontend is running (`http://localhost:5173`)\n- [ ] User is logged in (token in localStorage)\n- [ ] Browser console shows no JavaScript errors\n- [ ] Network tab shows API calls being made\n- [ ] Backend logs show points being updated\n- [ ] Database reflects points changes\n- [ ] Toast component is imported and used\n- [ ] `onShowToast` prop passed from parent\n\n---\n\n## ğŸ“Š Data Model\n\n### UserDetail Table\n```sql\nUSER_DETAIL\nâ”œâ”€â”€ id (UUID)\nâ”œâ”€â”€ email (String)\nâ”œâ”€â”€ fullName (String)\nâ”œâ”€â”€ password (String)\nâ”œâ”€â”€ points (Integer)  â† This field stores reward points\nâ””â”€â”€ ...(other fields)\n```\n\n### Update Operations\n```sql\n-- Add 5 points\nUPDATE USER_DETAIL SET points = points + 5 WHERE email = ?\n\n-- Deduct 5 points (only if points >= 5)\nUPDATE USER_DETAIL SET points = points - 5 \nWHERE email = ? AND points >= 5\n```\n\n---\n\n## ğŸ¯ Testing Commands\n\n### cURL - List Coupon\n```bash\ncurl -X POST http://localhost:8080/api/coupons \\\n  -H \"Authorization: Bearer {token}\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"title\": \"Test Coupon\",\n    \"code\": \"SAVE20\",\n    \"platform\": \"Amazon\",\n    \"category\": \"Shopping\",\n    \"discountType\": \"PERCENTAGE\",\n    \"validTill\": \"2026-12-31\"\n  }'\n```\n\n### cURL - View Code\n```bash\ncurl -X POST http://localhost:8080/api/coupons/{couponId}/view-code \\\n  -H \"Authorization: Bearer {token}\"\n```\n\n---\n\n## ğŸ“ Support\n\n### Common Issues\n\n**Points not increasing after coupon listed**\n- Check if `addPointsByEmail()` is called in `CouponListingService`\n- Verify database transaction is committed\n- Check user exists in database\n\n**Code reveal shows error \"Insufficient points\"**\n- User has less than 5 points\n- This is correct behavior\n- User needs to list more coupons to earn points\n\n**Toast not appearing**\n- Verify `onShowToast` prop passed to CouponDetailModal\n- Check `useToast()` hook is used in parent\n- Inspect browser console for errors\n\n**API call fails**\n- Check Authentication header present\n- Verify token is valid\n- Check backend is running\n- Review server logs for exceptions\n\n---\n\n## ğŸ”„ Request-Response Examples\n\n### Success: View Code\n```\nRequest:\nPOST /coupons/550e8400-e29b-41d4-a716-446655440000/view-code\nAuthorization: Bearer eyJhbGc...\n\nResponse (200 OK):\n{\n  \"message\": \"5 points deducted successfully\"\n}\n\nFrontend Effect:\nâœ“ setShowCode(true)\nâœ“ showToast(\"5 points deducted! Coupon code revealed.\", \"info\")\nâœ“ Button is enabled\nâœ“ Code displays without asterisks\n```\n\n### Error: Insufficient Points\n```\nRequest:\nPOST /coupons/550e8400-e29b-41d4-a716-446655440000/view-code\nAuthorization: Bearer eyJhbGc...\n\nResponse (400 Bad Request):\n{\n  \"message\": \"Insufficient reward points\"\n}\n\nFrontend Effect:\nâœ— setShowCode(false)\nâœ— showToast(\"Failed to reveal code. You may not have enough points.\", \"error\")\nâœ“ Button is enabled\nâœ— Code remains masked with asterisks\n```\n\n---\n\n*Quick Reference v1.0 - 2026-02-14*\n